@using AdventureGame.Engine.Models.Actions
@using AdventureGame.Engine.Effects

@code {
    [Parameter] public EffectGroup Effects { get; set; } = new();
    [Parameter] public EventCallback OnChange { get; set; }

    private void AddEffect()
    {
        Effects.Definitions.Add(new EffectDefinition());
        _ = OnChange.InvokeAsync();
    }

    private void RemoveDefinition(EffectDefinition def)
    {
        Effects.Definitions.Remove(def);
        _ = OnChange.InvokeAsync();
    }
}

<RadzenFieldset Text="Effects" Style="width:100%">
    <RadzenStack Orientation="Orientation.Vertical" Gap="8">
        @if (!Effects.Definitions.Any())
        {
            <RadzenAlert AlertStyle="AlertStyle.Info" Variant="Variant.Flat">
                No effects defined. Add one below.
            </RadzenAlert>
        }

        @foreach (var def in Effects.Definitions.ToList())
        {
            <RadzenCard Style="padding: 8px;">
                <RadzenStack Orientation="Orientation.Vertical" Gap="8">
                    <RadzenStack Orientation="Orientation.Horizontal" Gap="8" AlignItems="AlignItems.Center" JustifyContent="JustifyContent.SpaceBetween">
                        <RadzenBadge Text="Effect" BadgeStyle="BadgeStyle.Success" />
                        <RadzenButton Icon="delete" 
                                    Size="ButtonSize.Small" 
                                    ButtonStyle="ButtonStyle.Danger" 
                                    Click="@(_ => RemoveDefinition(def))" />
                    </RadzenStack>
                    <EffectNodeEditor Definition="@def" OnChange="@OnChange" />
                </RadzenStack>
            </RadzenCard>
        }

        <RadzenButton Icon="add" 
                    Text="Add Effect" 
                    ButtonStyle="ButtonStyle.Success"
                    Click="@(_ => AddEffect())" />
    </RadzenStack>
</RadzenFieldset>
