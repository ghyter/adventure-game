@page "/"
@using Microsoft.ML.OnnxRuntime
@using Microsoft.ML.OnnxRuntime.Tensors
@using System.IO
@using Microsoft.Maui.Storage
@using System.Diagnostics
@inject NotificationService NotificationService

<PageTitle>Home</PageTitle>

<RadzenStack Gap="16">
    <RadzenText TextStyle="TextStyle.H3">Adventure Game Editor</RadzenText>
    
    <RadzenMarkdown>
This application allows you to create and manage text-based adventure games with ease. Use the sidebar to navigate through different sections of your game pack, including scenes, items, characters, and more.

##### Getting Started
- From the **Games** menu at the left, create a new Game Pack. This stores all of your game data.
- To load an existing game pack, use the "Load Game Pack" option.
- Use the **Tools** menu to test conditions and effects on your game packs.
    </RadzenMarkdown>

    <RadzenCard Style="background: var(--rz-primary-lighter); padding: 16px;">
        <RadzenStack Gap="8">
            <RadzenText TextStyle="TextStyle.H6">📁 GamePacks Folder</RadzenText>
            <RadzenText TextStyle="TextStyle.Body2">Your game packs are stored in:</RadzenText>
            <RadzenStack Orientation="Orientation.Horizontal" Gap="8" AlignItems="AlignItems.Center">
                <RadzenText TextStyle="TextStyle.Caption" Style="font-family: monospace; flex: 1;">@PacksFolder</RadzenText>
                <RadzenButton Icon="folder_open" Text="Open" Size="ButtonSize.Small" Click="@OpenPacksFolderAsync" />
            </RadzenStack>
        </RadzenStack>
    </RadzenCard>

    <RadzenText Text="@Output"/>
</RadzenStack>

@code {
    private string Output = string.Empty;
    private string PacksFolder = string.Empty;

    protected override void OnInitialized()
    {
        try
        {
            PacksFolder = Path.Combine(FileSystem.AppDataDirectory, "GamePacks");
            Directory.CreateDirectory(PacksFolder);
        }
        catch { }
    }

    private async Task OpenPacksFolderAsync()
    {
        try
        {
            if (string.IsNullOrWhiteSpace(PacksFolder))
            {
                PacksFolder = Path.Combine(FileSystem.AppDataDirectory, "GamePacks");
            }
            Directory.CreateDirectory(PacksFolder);
            // On Windows, open in File Explorer
            Process.Start(new ProcessStartInfo("explorer.exe", PacksFolder) { UseShellExecute = true });
        }
        catch (Exception ex)
        {
            NotificationService.Notify(new NotificationMessage 
            { 
                Severity = NotificationSeverity.Error, 
                Summary = "Open Folder failed", 
                Detail = ex.Message, 
                Duration = 4000 
            });
        }
    }
}
